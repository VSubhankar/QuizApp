<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Quiz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Add New Quiz</h1>

        <!-- Quiz Title Input -->
        <div class="mb-3">
            <label for="quizTitle" class="form-label">Quiz Title:</label>
            <input type="text" class="form-control" id="quizTitle" placeholder="Enter quiz title" required>
        </div>

        <!-- Questions Table -->
        <h4 class="mt-4">Select Questions to Include:</h4>
        <table class="table table-striped mt-3">
            <thead>
                <tr>
                    <th scope="col">QID</th>
                    <th scope="col">Question Text</th>
                    <th scope="col">Select</th>
                </tr>
            </thead>
            <tbody id="questionsTableBody">
                <!-- Dynamic rows will be appended here -->
            </tbody>
        </table>

        <!-- Submit Button -->
        <button id="submitButton" class="btn btn-primary mt-3">Add Quiz</button>
    </div>

    <script>
        // Fetch and display questions in the table
        fetch('http://localhost:8080/questions')
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById('questionsTableBody');
                data.forEach(question => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <th scope="row">${question.id}</th>
                        <td>${question.questionText}</td>
                        <td><input type="checkbox" class="form-check-input" value="${question.id}"></td>
                    `;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => {
                console.error('Error fetching questions:', error);
                alert('Failed to load questions. Please try again.');
            });

        // Handle the submission of the quiz
        document.getElementById('submitButton').addEventListener('click', function() {
            const quizTitle = document.getElementById('quizTitle').value;
            const selectedQuestions = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(checkbox => parseInt(checkbox.value));
            console.log(selectedQuestions);

            if (quizTitle === '' || selectedQuestions.length === 0) {
                alert('Please enter a quiz title and select at least one question.');
                return;
            }

            const newQuiz = {
                title: quizTitle,
                questions: selectedQuestions
            };
            console.log(newQuiz);

            fetch('http://localhost:8080/quizzes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(newQuiz)
            })
            .then(response => {
                if (response.ok) {
                    alert('Quiz added successfully!');
                    document.getElementById('quizTitle').value = '';
                    document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
                } else {
                    alert('Failed to add quiz.');
                }
            })
            .catch(error => {
                console.error('Error adding quiz:', error);
                alert('Failed to add quiz. Please try again.');
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
